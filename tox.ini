[tox]
envlist = py{27,37,38}
ignore_basepython_conflict = True
skip_missing_interpreters = True

[testenv]
usedevelop = True
install_command = pip install {opts} {packages}
setenv =
  UNFURL_HOME={envtmpdir}/unfurl_home
  UNFURL_TMPDIR={envtmpdir}
passenv=ANSIBLE_VERBOSITY ANSIBLE_DEBUG UNFURL_LOGGING UNFURL_TEST_* ANDROID_*
basepython =
    py27: python2.7
    py37: python3.7
    py38: python3.8
deps =
  -r{toxinidir}/requirements.txt
  -r{toxinidir}/test-requirements.txt
  docutils
  check-manifest
  flake8
commands =
;XXX    check-manifest --ignore tox.ini,tests*
    python setup.py check -m -r -s
;    flake8 .
; posargs: e.g. tox -- -p test_attributes.py
    python -m unittest discover -s tests {posargs}

[testenv:docs]
basepython = python3.8
deps =
  sphinx>=2.4.0
  typed_ast
  recommonmark
  sphinx-click
  stevedore>=1.20.0
  sphinxbootstrap4theme
; -W turns warnings into errors
commands = sphinx-build ./docs {toxworkdir}/docs/html -d {toxworkdir}/docs/doctrees --color -bhtml {posargs}
           python -c 'import pathlib; print("documentation available under file://\{0\}".format(pathlib.Path(r"{toxworkdir}") / "docs" / "html" / "index.html"))'

[flake8]
exclude = .tox,*.egg,build,data
select = E,W,F
